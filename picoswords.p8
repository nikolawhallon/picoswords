pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
p1x = 64  p1y = 64
p2x = 32  p2y = 32
f = 0
fpf = 10
kifpf = 10
kmfpf = 3
kdir = 'right'
kmov = false
gfpf = 3
i = 1

p1score = 0
p2score = 0

hearts = {}
h1 = {44, 32}
h2 = {60, 32}
h3 = {76, 32}
add(hearts, h1)
add(hearts, h2)
add(hearts, h3)

music(0)

player = {
 x=32,
 y=32,
 dir='right',
 mov=false,

 -- animations
 -- an animation is:
 -- * array of sprite indices
 -- * fpi (frames-per-index)
 -- * update function
 --   - f (frame) input
 -- if (f / fpi % n == 0) then
 -- where n=1..num indices
 -- set spr to i[n]
 -- e.g. heart could be:
 -- anm:new([1,2],10)
 new=function(self,tbl)
  tlb=tbl or {}
  setmetatable(tbl,{
   __index=self
  })
  return tbl
 end
}

players={}
p1=player:new({x=16,y=16})
add(players,p1)

function _update()
  if (btn(0, 0)) then p1x-=1 end
  if (btn(1, 0)) then p1x+=1 end
  if (btn(2, 0)) then p1y-=1 end
  if (btn(3, 0)) then p1y+=1 end

  if p1x > 128 then p1x -= 128 end
  if p1x < -8 then p1x += 128 end

  if p2x > 128 then p2x -= 128 end
  if p2x < -8 then p2x += 128 end
  
  if p1y > 128 then p1y -= 128 end
  if p1y < -8 then p1y += 128 end
  
  if p2y > 128 then p2y -= 128 end
  if p2y < -8 then p2y += 128 end

  if (btn(0, 1)) then p2x-=1 kdir = 'left' end
  if (btn(1, 1)) then p2x+=1 kdir = 'right' end
  if (btn(2, 1)) then p2y-=1 end
  if (btn(3, 1)) then p2y+=1 end

  if (btn(0, 1) or btn(1, 1) or btn(2, 1) or btn(3, 1)) then
    kmov=true
  else
    kmov=false
  end
end

function _draw()
  cls(1)
  
  map(0, 0, 0, 0, 16, 16)

  print("p1:", 10, 9, 14)
  print(tostr(p1score), 22, 9, 14)
  print("p2:", 100, 9, 14)
  print(tostr(p2score), 112, 9, 14)

  if (f / fpf % 2 == 0) then
    i = 1
  elseif (f / fpf % 2 == 1) then
    i = 2
  end

  for _, p in ipairs(hearts) do
    if sqrt((p1x-p[1])*(p1x-p[1]) + (p1y-p[2])*(p1y-p[2])) < 8 then
      del(hearts, p)
      p1score += 1
    elseif sqrt((p2x-p[1])*(p2x-p[1]) + (p2y-p[2])*(p2y-p[2])) < 8 then
      del(hearts, p)
      p2score += 1
    end
  end
  
  for _, p in ipairs(hearts) do
    spr(i, p[1], p[2])
  end
  
  kfpf=kifpf
  if kmov then
    kfpf=kmfpf
  end
  
  if (f / kfpf % 2 == 0) then
    k = 19
  elseif (f / kfpf % 2 == 1) then
    if kmov then
      k = 21
    else
      k = 20
    end
  end

  if kdir == 'right' then
    spr(k, p2x, p2y, 1, 1)
  else
    spr(k, p2x, p2y, 1, 1, true)
  end

  if (f / gfpf % 3 == 0) then
    j = 5
  elseif (f / gfpf % 3 == 1) then
    j = 6
  elseif (f / gfpf % 3 == 2) then
    j = 7
  end

  spr(j, p1x, p1y)

  if kmov then
    spr(28, 80, 80)
  end
  
  for p in all(players) do
    spr(28, p.x, p.y)
  end
  
  f += 1
end
__gfx__
0000000007700ee00000000007760776222200000000000000000000000000000077770000777700007777000000000000000000000000000000000000000000
0000000077eeeeee07e00ee007660766200202200077770000777700007777000660606006606060066060600000000000000000000000000000000000000000
007007007eeeeeee7eeeeeee06660666200202200777777007777770077777700660606006606060066060600000000000000000000000000000000000000000
00077000eeeeeeeeeeeeeeee00000000222200000707707007077070070770700066660000666600006666000000000000000000000000000000000000000000
000770000eeeeee0eeeeeeee77607760000022220707707007077070070770700006060000006000000060000000000000000000000000000000000000000000
0070070000eeee000eeeeee076607660022020020777777007777770077777700000700000070000000007000000000000000000000000000000000000000000
00000000000ee00000eeee0066606660022020020707707000770770077077000007070000707000000070700000000000000000000000000000000000000000
0000000000000000000ee00000000000000022220000000000000000000000000000600000060000000006000000000000000000000000000000000000000000
00000000000000bbbb0000000220000022000000220000000ee00000ee000000ee0000000ee00000ee000000ee00000000000000000620000000000000000000
00000000bbbbbbbbbbbbbbbb226666600220000002200000eeccccc00ee000000ee00000ee6666600ee000000ee0000000600000000620000000000000000000
00000000bbbbbbbbbbbbbbbb00667670006666600066666000cc7c7000ccccc000ccccc000667670006666600066666000d7777006dddd200000000000000000
00000000bbbbbbbbbbbbbbbb00667670006676700066767000cc7c7000cc7c7000cc7c7000667670006676700066767066d66667007662000000000000000000
00000000333333333333333300666660006676700066767000ccccc000cc7c7000cc7c7000666660006676700066767022d66662007662000000000000000000
00000000bbbbbbbbbbbbbbbb000666000066666000666660000ccc0000ccccc000ccccc000066600006666600066666000d22220007662000000000000000000
00000000000000bbbb000000000666000006660000066600000ccc00000ccc00000ccc0000066600000666000006660000200000007662000000000000000000
00000000000000000000000000600060006000600006060000c000c000c000c0000c0c0000600060006000600006060000000000000720000000000000000000
00000000000000000000000008008000000000000000000008800000880000008800000000000000000000000000000000000000000000000000000000000000
00000000000000000000000008808800000000000000000088555550088000000880000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000888800008080000000000000557570005555500055555000000000000000000000000000000000000000000000000000000000
00000000000000000000000008878780008888000000000000557570005575700055757000000000000000000000000000000000000000000000000000000000
00000000000000000000000008878780088787800000000000555550005575700055757000000000000000000000000000000000000000000000000000000000
00000000000000000000000008888880088787800000000000055500005555500055555000000000000000000000000000000000000000000000000000000000
00000000000000000000000000888800008888000000000000055500000555000005550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000500050005000500005050000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000003300000330000003300000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000bbbb00000000000000000033ddddd0033000000330000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000bbbbbb0000000000000000000dd7d7000ddddd000ddddd000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbb7b7b000000000000000000dd7d7000dd7d7000dd7d7000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbb7b7b000000000000000000ddddd000dd7d7000dd7d7000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbb0000000000000000000ddd0000ddddd000ddddd000000000000000000000000000000000000000000000000000000000
0000000000000000000000000bbbbbb00000000000000000000ddd00000ddd00000ddd0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000d000d000d000d0000d0d0000000000000000000000000000000000000000000000000000000000
__map__
0303030303030300000303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300040400000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300040400000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000404040400000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000400000400000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000400000400000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000404040400000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1100000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000404000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000404000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030300000303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011000002653226500265002153020531205002153021500265322650026500295302853128500295302950026532265002650021530205312050021530215002353024530235302453021532215002150021500
011000000c17300000000000c17300000000000c173000000c6550c6000c6000c600000000000000000000000c1730c6000c6000c6550c173000000c655000000c1730c1730c1000c1730c655000000000000000
01100000325322650026500305302f531205002d530215002c5322d5502c5502d5302953129532285302950026532265002650021530205312050021530215001d5301d0001a5321a0001c5311c5322150021500
__music__
01 00014344
00 00014344
00 02014344
02 02014344

